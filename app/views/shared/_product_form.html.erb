<%= render "shared/errors", obj: @products %>
<table class="attr">
  <tr>
    <th><%= form.label :name, "名前" %></th>
    <td><%= form.text_field :name %></td>
  </tr>
  <tr>
    <th><%= form.label :kinds, "種類" %></th>
    <td><%= form.select :kinds, options_for_select(@kinds) %></td>
  </tr>
  <tr>
    <th><%= form.label :price, "値段" %></th>
    <td><%= form.text_field :price %></td>
  </tr>
  <tr>
    <th><%= form.label :published, "公開" %></th>
    <td>
    <%= form.radio_button :published, true %>
    <%= label_tag :published_true, "する" %>
    <%= form.radio_button :published, false %>
    <%= label_tag :published_false, "しない" %>
    </td>
  </tr>
  <tr>
   <th><%= form.label :kids, "子供向け" %></th>
    <td>
   <%= form.radio_button :kids, true %>
   <%= label_tag :kids_true, "はい" %>
   <%= form.radio_button :kids, false %>
   <%= label_tag :kids_false, "いいえ" %>
   </td>
  </tr>
  <tr>
   <th><%= form.label :recommend, "おすすめ" %></th>
    <td>
   <%= form.radio_button :recommend, true %>
   <%= label_tag :recommend_true, "はい" %>
   <%= form.radio_button :recommend, false %>
   <%= label_tag :recommend_false, "いいえ" %>
   </td>
  </tr>
  <tr>
  <th><%= form.label :stocks, "材料" %></th>
  <td>
    <%= form.collection_check_boxes(:stock_ids, @stocks, :id, :name) do |cb| %>
      <div>
        <%= cb.check_box %>
        <%= cb.label %>
         <%= text_field_tag "stock_quantities[#{cb.object.id}]", 0, size: 3,
         class: "stock-quantity" %> 
      </div>
    <% end %>
  </td>
</tr>
  <tr>
    <th><%= form.label :explanation, "説明" %></th>
    <td><%= form.text_area :explanation, rows: 5, cols: 50 %></td>
  </tr>
  <tr>
   <th><%= form.label :new_profile_picture, "商品画像" %></th>
   <td><%= form.file_field :new_profile_picture %></td>
  </tr>
</table>

<%= javascript_tag do %>
  document.addEventListener('submit', function(event) {
    let invalid = false;

    // チェックされた材料に対応する数量入力欄のみを対象にする
    document.querySelectorAll('.stock-quantity').forEach(function(input) {
      const checkbox = input.closest('div').querySelector('input[type="checkbox"]'); // 対応するチェックボックスを取得
      if (checkbox && checkbox.checked) { // チェックされている場合のみ数量を検証
        if (parseInt(input.value) <= 0 || isNaN(parseInt(input.value))) {
          invalid = true;
          input.style.borderColor = 'red'; // エラーを赤枠で表示
        } else {
          input.style.borderColor = ''; // 正常な場合は枠を元に戻す
        }
      }
    });

    if (invalid) {
      event.preventDefault(); // 数量が不正なら送信を中止
      alert("材料の数量は0より大きい値でなければなりません。");
      window.location.reload();
    }
  });
<% end %>


